all: xdpallrx.o xdpvxlan.o xdpvxlanvni.o

prefix = @prefix@
INSTALL = @INSTALL@

%.llvmir: ../../elements/userlevel/bpf/%.c
	clang -O2 -Wno-compare-distinct-pointer-types -emit-llvm -c $< -o $@

%.o: %.llvmir
	llc -march=bpf -filetype=obj -o $@ $<

install: xdpallrx.o xdpvxlan.o
	$(INSTALL) xdpallrx.o -m 0644 -D $(DESTDIR)$(prefix)/lib/click/xdpallrx.o
	$(INSTALL) xdpvxlan.o -m 0644 -D $(DESTDIR)$(prefix)/lib/click/xdpvxlan.o
	$(INSTALL) xdpvxlanvni.o -m 0644 -D $(DESTDIR)$(prefix)/lib/click/xdpvxlanvni.o

clean:
	rm -f *.llvmir
	rm -f *.o
